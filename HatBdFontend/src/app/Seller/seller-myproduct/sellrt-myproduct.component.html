<div class="product-page">

  <div class="page-header">
    <h2>My Products</h2>
  </div>

  <!-- FORM -->
  <div class="form-card">
    <input placeholder="Product Name" [(ngModel)]="name" />
    <input placeholder="Brand" [(ngModel)]="brand" /> <!-- ✅ BRAND -->
    <input placeholder="Description" [(ngModel)]="description" />

    <input type="number" placeholder="Price" [(ngModel)]="price" />
    <input type="number" placeholder="Stock Quantity" [(ngModel)]="stockquantity" />

    <select [(ngModel)]="categoryid" (change)="loadSubCategories(categoryid!)">
      <option [ngValue]="null" disabled selected>
        Select Category
      </option>
      <option *ngFor="let c of categories" [value]="c.id">
        {{ c.name }}
      </option>
    </select>

    <select [(ngModel)]="subcategoryid">
      <option [ngValue]="null" disabled selected>Select Sub Category</option>
      <option *ngFor="let sc of subCategories" [value]="sc.id">
        {{ sc.name }}
      </option>
    </select>

    <div *ngIf="currentImageLocation && !selectedFile">
      <label>Current Image:</label>
      <img [src]="getImageUrl(currentImageLocation)"
        style="height: 60px; width: 60px; object-fit: cover; margin: 10px 0;">
    </div>
    <input type="file" (change)="onFileSelected($event)" accept="image/*" />

    <button class="btn-primary" (click)="saveProduct()">
      {{ id ? 'Update Product' : 'Add Product' }}
    </button>
  </div>

  <!-- SEARCH -->
  <div class="search-bar">
    <input type="text" placeholder="Search by name / brand / category..." [(ngModel)]="searchText"
      (input)="searchProduct()" />
  </div>

  <!-- TABLE -->
  <div class="table-card">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Image</th>
          <th>Name</th>
          <th>Brand</th> <!-- ✅ BRAND COLUMN -->
          <th>Category</th>
          <th>SubCategory</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let p of filteredProducts; let i = index">
          <td>{{ i + 1 }}</td>

          <td>
            <img [src]="getImageUrl(p.imageLocation)" class="product-img" />
          </td>

          <td>{{ p.name }}</td>
          <td>{{ p.brand }}</td> <!-- ✅ BRAND -->
          <td>{{ p.categoryName }}</td>
          <td>{{ p.subCategoryName }}</td>
          <td>{{ p.price }}</td>
          <td>{{ p.stockquantity }}</td>
          <td>{{ p.status }}</td>

          <td class="action-btns">
            <button class="btn-edit" (click)="editProduct(p)">Edit</button>
            <button class="btn-delete" (click)="deleteProduct(p.id)">Delete</button>
          </td>
        </tr>

        <tr *ngIf="filteredProducts.length === 0">
          <td colspan="9" class="no-data">No Products Found</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>